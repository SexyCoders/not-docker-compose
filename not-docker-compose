#!/bin/bash

declare -A ndc_config
declare -A ndc_state
command=$1;
allowed_commands=("test");
no_goodbye=0;
no_hello=0;
config_lines=();

array_contains () { 
    local array="$1[@]"
    local seeking=$2
    local in=1
    for element in "${!array}"; do
        if [[ $element == "$seeking" ]]; then
            in=0
            break
        fi
    done
    return $in
}

on_init(){
  recover_env_state;

  if [ ! no_hello ];then
    hello;
  fi
}

before_exit(){
  store_env_state;

  if [ ! no_goodbye ];then
    goodbye;
  fi
}

store_env_state(){
  echo "Storing env state to filesystem.";
}

recover_env_state(){
  echo "Recovering env state from filesystem.";
}

goodbye(){
  echo "****************************************************************";
  echo "*************************** GOODBYE ****************************";
  echo "****************************************************************";
}

hello(){
  echo "****************************************************************";
  echo "********************** NOT-DOCKER-COMPOSE **********************";
  echo "****************************************************************";
}

parse_config(){
  config_file="$1"
  if [ ! -f "$config_file" ]; then
    config_file="composefile";
    if [ ! -f "$config_file" ]; then
      config_file="Composefile";
      if [ ! -f "$config_file" ]; then
        echo "Config file not found! Aborting!" >&2
        return;
      fi
    fi
  fi

  while read -r line; do
    config_lines+=("$line")
  done < $config_file;

  for line in ${config_lines[@]}; do
    IFS=' ' read -ra my_array <<< $line
      array_contains allowed_commands "${my_array[0]}" && echo "${my_array[0]}";
  done
}

on_init;
if [ "$1" = "config" ];then
  if [ "$2" = "init" ];then
    parse_config "$3";
  fi
  #parse_config "$2";
fi
before_exit;
